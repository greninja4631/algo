アーキテクチャ設計ドキュメント

7. 学び・成長ロードマップ（全体像）
	1.	**API仕様（include/以下）**を読んで全体設計と使い方を理解
	2.	src/以下の実装で「情報隠蔽・責務分離」の具体手法を体験
	3.	tests/ で「テストファースト・CI/CD文化」の技術を獲得
	4.	util/・docs/ で運用・拡張・DevOps文化まで学ぶ

⸻


1. ディレクトリ＆レイヤー構成
src/
├── stack.c               // スタック（LIFO: 最後に入れたデータが最初に出る）内部実装
│                         // 単純な配列/リストの応用。push/popでデータ操作。
│                         // Undo/Redoや計算機、再帰アルゴリズム等に応用される。
│                         // 責務：データ追加・削除の順序管理のみ担当
├── queue.c               // キュー（FIFO: 最初に入れたデータが最初に出る）内部実装
│                         // 通常配列 or リンクリストで実現。enqueue/dequeue。
│                         // OSのタスク管理や印刷ジョブなど幅広く使われる。
│                         // 責務：順番制御のみを担当。副作用や外部依存なし。
├── doubly_list.c         // 双方向リスト（両側リンク）内部実装
│                         // ノード同士が「前/次」両方を参照できる。list, deque, LRUキャッシュ等で使う。
│                         // 責務：任意位置挿入・削除、前後移動の効率化。
├── rpn_calculator.c      // 逆ポーランド記法（RPN）電卓ロジック
│                         // スタックを活用して中置→後置の計算処理を効率化。
│                         // 責務：数式処理/計算ロジックのみ。I/OやUI層とは非依存。
├── round_robin.c         // ラウンドロビン・スケジューラ（OSプロセス公平制御）
│                         // キュー＆サイクルアルゴリズムで複数プロセスを公平に管理。
│                         // OS設計・分散ジョブ管理など実用例多数。
│                         // 責務：割り当て順序管理、時間量制御。
├── history_system.c      // Undo/Redo履歴管理（コマンドパターン＋双方向リスト）
│                         // コマンド履歴を動的リストで管理。ユーザー操作の巻き戻し等に必須。
│                         // 責務：コマンド記録・復元管理、実装は完全カプセル化。
├── hashmap.c             // 汎用ハッシュテーブル（Key-Valueストア、チェイニング法）
│                         // O(1)高速検索・追加・削除を提供。衝突時はリストチェイニング方式。
│                         // カスタムハッシュ関数/比較関数/DI対応。Linuxカーネル思想に近い。
│                         // 責務：データ格納/検索のみ。他構造や副作用と分離。
├── lru_cache.c           // LRUキャッシュ（Least Recently Usedキャッシュ管理）
│                         // 「最近使われていないデータ」を効率追放。hashmap×双方向リスト応用。
│                         // Web/DBキャッシュ/OSメモリ管理で現場採用例多数。
│                         // 責務：キャッシュ戦略のみ。ストレージや外部I/O非依存。
├── url_shortener.c       // URL短縮サービスのアルゴリズム（hashmap+base62応用）
│                         // Key-Valueとエンコードを使い短縮URL生成。現実Webサービス例。
│                         // 責務：短縮・復元処理のみ。他責務とは分離。
├── util/
│   ├── logger.c          // ロギング（INFO/ERROR等、DevOps/運用向け）
│   │                     // 標準出力・ファイル・クラウド連携も容易な拡張設計
│   ├── metrics.c         // メトリクス収集/クラウド監視用（Prometheus/GCP連携も想定）
│   └── memory.c          // メモリ管理（カスタムmalloc/free、トラッキング・安全性担保）
│                         // テストや運用監視、リーク検出にも活用可

include/
├── data_structures.h     // データ構造・アルゴリズムのAPI宣言ヘッダー（実装は隠蔽）
│                         // 利用者はこのAPIのみで全体操作可
├── config.h              // グローバル設定・定数定義（構成切替・パラメータ管理）
├── hashmap.h             // ハッシュテーブルAPI宣言（ADT化・内部隠蔽・型安全設計）
├── lru_cache.h           // LRUキャッシュAPI宣言（責務分離・拡張性担保）
│                         // APIの目的・型・返却値・エラー管理も全てドキュメント化

tests/
├── test_stack.c          // スタックAPIの単体テスト（TDD/CI/CD文化前提、assert網羅）
├── test_queue.c          // キューAPIの単体テスト
├── test_doubly_list.c    // 双方向リストAPIの単体テスト
├── test_rpn_calculator.c // RPN電卓APIの単体テスト
├── test_round_robin.c    // ラウンドロビンAPIの単体テスト
├── test_history_system.c // Undo/Redo履歴システムの単体テスト
├── test_hashmap.c        // ハッシュテーブルの単体テスト（チェイニング等の衝突回避テスト含む）
├── test_lru_cache.c      // LRUキャッシュの単体テスト（エッジケース・多重アクセスも網羅）
├── test_url_shortener.c  // URL短縮アルゴリズムのテスト（正常・異常ケース分離）
└── test_util.c           // 各種ユーティリティ・クラウド運用/監視テスト

docs/
├── api.md                // 全APIの設計仕様書（返り値/パラメータ/副作用/責務/エラー対応）
├── architecture.md       // 全体アーキテクチャ・設計思想・運用指針ドキュメント
│                         // 「なぜこの分割なのか」「なぜこのレイヤーなのか」を詳細記述

	•	src/: 主要ロジック実装（データ構造・アルゴリズムごとに分離）
	•	src/util/: ログ・メトリクス・メモリ管理等の横断的共通機能（依存性注入の実践）
	•	include/: APIヘッダー宣言専用。外部公開APIのみを記載し、実装は完全に隠蔽
	•	tests/: 各モジュール単体テスト。すべてのAPIをテスト駆動・CI/CD前提で設計
	•	docs/: 設計思想やAPI仕様などのドキュメント

⸻

2. 設計思想と各層の役割

■ API駆動設計 & 抽象データ型（ADT）
	•	すべてのデータ構造・アルゴリズムは「APIファースト」で設計
	•	typedef struct ds_stack ds_stack_t;のように実装を隠蔽し、安全かつ拡張性を担保

■ 責務分離・変更に強い設計
	•	本体（src/）・API宣言（include/）・共通機能（util/）・テスト（tests/）を徹底的に分離
	•	変更時も影響範囲が限定され、現場の開発・保守性が圧倒的に向上

■ 依存性注入（DI）/ テストファースト / DevOps対応
	•	ログ出力・メモリ管理・観測メトリクスは差し替え可能なインターフェース設計
	•	単体テストは全API網羅、assert・戻り値による自動検証＝CI/CD文化を徹底
	•	metrics.cによる観測性（クラウド監視・運用監視の組み込み）

⸻

3. 学習できるスキル・現場応用力
	•	型安全で壊れないAPI設計（C言語でも現代的に）
	•	Undo/Redo・ラウンドロビンスケジューラなど現場アルゴリズム応用
	•	横断関心事（ロギング・メトリクス・メモリ管理）を運用目線で設計
	•	ドキュメント駆動・CI/CD・DevOps文化の実践

⸻

4. モジュールごとの設計ストーリー
	•	stack.c / queue.c / doubly_list.c
基本のデータ構造をAPIドリブン＆情報隠蔽で実装
→ 全て「戻り値はエラーコード・引数はポインタ・構造体は外から見えない」

	•	rpn_calculator.c
逆ポーランド記法による「計算アルゴリズムのデータ構造応用」
→ stackと文字列処理の応用で「実務現場力」を磨く
•	RPNの本質は「数値や演算子を順に処理し、スタックに積む」
アルゴリズムにある

	•	round_robin.c
OS設計を意識したプロセススケジューラ。
→ queue・プロセス管理・循環アルゴリズムの現場適用例
	•	history_system.c
コマンドパターンと双方向リストでUndo/Redo管理。
→ オフィスソフトや画像編集ソフトなど実務現場と直結する機能
	•	util/logger.c, metrics.c, memory.c
すべてのデータ構造・アルゴリズムが「横断的な観測性・可視化」を持つ。
→ 実プロダクト品質のための依存性注入（DI）設計

⸻

5. テストと品質保証
	•	tests/以下に各API・各データ構造ごとのユニットテストを配置
	•	assert()および戻り値による厳格な自動検証
	•	テスト駆動（TDD）、CI/CDと完全に連動できる

⸻

6. ドキュメントと属人化排除
	•	docs/api.md / architecture.md
設計思想やAPI仕様は必ず文章で明示し、属人化ゼロ・誰でも保守・引き継ぎ可能な体制

⸻

7. 学び・成長のためのステップ
	1.	API設計（include/data_structures.h）を読む
→ 使い方・意図・安全性を確認
	2.	src/の実装を見る
→ 「どう隠蔽され、どのように責務分離されているか」を体感
	3.	tests/を読む・書き換える
→ テストファースト・CI/CD水準の自動テスト文化を身につける
	4.	共通機能(util/)やドキュメント(docs/)を参考に
→ 運用・拡張・現場移行まで見据えた「設計の本質」を学ぶ


